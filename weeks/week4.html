<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>SPA 225 — Week 4 (Discussions)</title>
    <meta name="description" content="SPA 225 Discussions — Week 4" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="../style.css?v=3" />
  </head>

  <body>
    <a class="skip-link" href="#main">Skip to content</a>

    <header class="hero" role="banner">
      <div class="hero__inner">
        <h1 class="hero__title">SPA 225: Lying, swearing and breaking the rules</h1>
        <p class="hero__subtitle">Discussions</p>
      </div>
    </header>

    <main id="main" class="main" role="main">
      <nav class="page-nav" aria-label="Week navigation">
        <a class="nav-link" href="../index.html">← Back to weeks</a>

        <div class="nav-group" aria-label="Previous and next week">
          <a class="nav-link" href="./week3.html">← Prev</a>
          <a class="nav-link" href="./week5.html">Next →</a>
        </div>
      </nav>

      <header class="week-header">
        <h2 class="week-title">Week 4</h2>
        <!-- Optional: add dates here later -->
      </header>

      <section class="card" aria-labelledby="slides-title">
        <h3 id="slides-title" class="section-title">Slides and study material</h3>

        <div class="slides-embed" id="slides-week4" aria-label="Slides and materials container (Week 4)">
          <!-- START EDITABLE: SLIDES/STUDY MATERIAL -->
          <!-- Paste OneDrive embed iframe(s) and study content below -->

          <!-- NOTE (invisible to students):
               - Keep iframe width="100%" for responsive layout.
               - Use a meaningful iframe title for accessibility.
               - For external links, prefer: target="_blank" rel="noopener noreferrer".
          -->

          <!-- OneDrive placeholder: pega aquí tu link de embed -->
          <!--
          <iframe
            title="Week 4 slides (OneDrive)"
            src=""
            width="100%"
            height="520"
            frameborder="0"
            allowfullscreen
          ></iframe>
          -->

          <!-- END EDITABLE -->


<section id="vocab-match">
  <div class="vm-wrap" role="region" aria-label="Juego: conectar palabra con definición">
    <header class="vm-head">
      <h2 class="vm-title">Conecta el término con su definición</h2>
      <p class="vm-subtitle">
        Elige cómo conectar: <strong>arrastra</strong>, <strong>haz clic en un término y luego en una definición</strong>,
        o <strong>escribe la letra</strong> (A–J) al lado del término.
      </p>

      <div class="vm-controls" role="group" aria-label="Controles del juego">
        <button class="vm-btn" data-action="shuffle" aria-label="Mezclar">Mezclar</button>
        <button class="vm-btn vm-btn-primary" data-action="check" aria-label="Comprobar">Comprobar</button>
        <button class="vm-btn" data-action="reset" aria-label="Reiniciar">Reiniciar</button>
      </div>

      <div class="vm-status" aria-live="polite"></div>
    </header>

    <div class="vm-board" aria-label="Tablero de emparejamiento">
      <div class="vm-col">
        <div class="vm-colhead">
          <span class="vm-coltitle">Términos</span>
          <span class="vm-colhint" id="vmHintLeft">Arrastra, clic→clic, o escribe una letra.</span>
        </div>
        <ul class="vm-list" id="vmTerms" aria-label="Lista de términos"></ul>
      </div>

      <div class="vm-col">
        <div class="vm-colhead">
          <span class="vm-coltitle">Definiciones</span>
          <span class="vm-colhint" id="vmHintRight">Cada definición tiene una letra (A–J).</span>
        </div>
        <ul class="vm-list" id="vmDefs" aria-label="Lista de definiciones"></ul>
      </div>
    </div>

    <footer class="vm-footer">
      <details class="vm-help">
        <summary>¿Cómo se juega?</summary>
        <ul>
          <li><strong>Arrastrar:</strong> toma un término y suéltalo sobre la definición.</li>
          <li><strong>Clic→Clic:</strong> clic en un término y luego clic en una definición (o al revés).</li>
          <li><strong>Letras:</strong> escribe A–J al lado del término. (Al escribir, se conecta automáticamente).</li>
          <li>Presiona <strong>Comprobar</strong> para ver el resultado.</li>
        </ul>
      </details>
    </footer>
  </div>

  <style>
    /* ===== Scoped CSS: #vocab-match ===== */
    #vocab-match {
      --vm-bg: #0f1216;
      --vm-panel: #151a21;
      --vm-card: #121821;
      --vm-card2: #10161f;
      --vm-ink: #f3ead9;       /* crema */
      --vm-muted: rgba(243, 234, 217, 0.74);
      --vm-faint: rgba(243, 234, 217, 0.55);
      --vm-border: rgba(243, 234, 217, 0.16);
      --vm-border2: rgba(243, 234, 217, 0.10);
      --vm-shadow: 0 12px 30px rgba(0,0,0,0.35);
      --vm-radius: 18px;
      --vm-radius2: 14px;
      --vm-good: rgba(78, 210, 146, 0.22);
      --vm-bad: rgba(255, 110, 110, 0.18);
      --vm-focus: rgba(120, 180, 255, 0.35);
      --vm-pick: rgba(120, 180, 255, 0.18);
      --vm-pickBorder: rgba(120, 180, 255, 0.55);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--vm-ink);
    }

    #vocab-match .vm-wrap {
      background: radial-gradient(900px 500px at 10% 0%, rgba(243,234,217,0.08), transparent 55%),
                  radial-gradient(800px 500px at 90% 10%, rgba(225,204,170,0.06), transparent 60%),
                  var(--vm-bg);
      border: 1px solid var(--vm-border2);
      border-radius: 24px;
      padding: 18px 16px 14px;
      box-shadow: var(--vm-shadow);
      overflow: hidden;
    }

    #vocab-match .vm-head { padding: 6px 6px 12px; }

    #vocab-match .vm-title {
      margin: 0 0 6px;
      font-size: clamp(18px, 2.1vw, 24px);
      letter-spacing: 0.2px;
    }

    #vocab-match .vm-subtitle {
      margin: 0 0 12px;
      color: var(--vm-muted);
      line-height: 1.35;
      max-width: 80ch;
      font-size: 14px;
    }

    #vocab-match .vm-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    #vocab-match .vm-btn {
      background: rgba(243,234,217,0.06);
      color: var(--vm-ink);
      border: 1px solid var(--vm-border);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
      user-select: none;
    }
    #vocab-match .vm-btn:hover { background: rgba(243,234,217,0.10); transform: translateY(-1px); }
    #vocab-match .vm-btn:active { transform: translateY(0px); }
    #vocab-match .vm-btn:focus-visible { outline: none; box-shadow: 0 0 0 3px var(--vm-focus); }
    #vocab-match .vm-btn-primary { background: rgba(243,234,217,0.12); border-color: rgba(243,234,217,0.22); }

    #vocab-match .vm-status {
      min-height: 20px;
      color: var(--vm-muted);
      font-size: 13px;
      padding: 2px 2px 0;
    }

    #vocab-match .vm-board {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      padding: 8px 6px 10px;
    }

    #vocab-match .vm-col {
      background: linear-gradient(180deg, rgba(243,234,217,0.05), rgba(243,234,217,0.02));
      border: 1px solid var(--vm-border2);
      border-radius: var(--vm-radius);
      padding: 12px;
      min-height: 260px;
    }

    #vocab-match .vm-colhead {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    #vocab-match .vm-coltitle { font-weight: 700; letter-spacing: 0.2px; font-size: 14px; }

    #vocab-match .vm-colhint {
      color: var(--vm-faint);
      font-size: 12px;
      line-height: 1.25;
      text-align: right;
      max-width: 44ch;
    }

    #vocab-match .vm-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 10px;
    }

    #vocab-match .vm-item {
      background: var(--vm-card);
      border: 1px solid var(--vm-border2);
      border-radius: var(--vm-radius2);
      padding: 10px 10px;
      display: grid;
      gap: 6px;
      transition: background 120ms ease, border-color 120ms ease, transform 120ms ease;
    }

    #vocab-match .vm-item[data-kind="term"] {
      background: linear-gradient(180deg, rgba(243,234,217,0.06), rgba(243,234,217,0.03)), var(--vm-card2);
      cursor: grab;
    }

    #vocab-match .vm-item[data-kind="term"]:active { cursor: grabbing; }
    #vocab-match .vm-item.vm-dragging { opacity: 0.55; transform: scale(0.99); }

    #vocab-match .vm-item[data-kind="def"].vm-dropzone {
      outline: 2px dashed rgba(243,234,217,0.25);
      outline-offset: 2px;
    }
    #vocab-match .vm-item[data-kind="def"].vm-over {
      outline-color: rgba(120,180,255,0.65);
      background: rgba(120,180,255,0.10);
    }

    #vocab-match .vm-item.vm-selected {
      border-color: var(--vm-pickBorder);
      background: linear-gradient(180deg, var(--vm-pick), rgba(0,0,0,0)), var(--vm-card);
    }

    #vocab-match .vm-item:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px var(--vm-focus);
    }

    #vocab-match .vm-rowtop {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    #vocab-match .vm-term {
      font-weight: 800;
      letter-spacing: 0.2px;
      font-size: 14px;
    }

    #vocab-match .vm-tag {
      font-size: 12px;
      color: rgba(15,18,22,0.92);
      background: rgba(243,234,217,0.90);
      border-radius: 999px;
      padding: 2px 8px;
      flex: 0 0 auto;
      letter-spacing: 0.4px;
      font-weight: 800;
    }

    #vocab-match .vm-deftext {
      color: var(--vm-muted);
      font-size: 13px;
      line-height: 1.25;
    }

    #vocab-match .vm-example {
      color: rgba(243,234,217,0.78);
      font-size: 12.5px;
      line-height: 1.25;
      border-left: 2px solid rgba(243,234,217,0.18);
      padding-left: 8px;
      margin-top: 2px;
    }

    #vocab-match .vm-assign {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 4px;
      padding-top: 6px;
      border-top: 1px solid rgba(243,234,217,0.10);
      color: var(--vm-faint);
      font-size: 12px;
    }

    #vocab-match .vm-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(243,234,217,0.06);
      border: 1px solid rgba(243,234,217,0.12);
      border-radius: 999px;
      padding: 4px 10px;
      max-width: 100%;
      flex: 1 1 auto;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    #vocab-match .vm-pill strong { color: rgba(243,234,217,0.92); font-weight: 800; }

    #vocab-match .vm-clear {
      border: 1px solid rgba(243,234,217,0.16);
      background: transparent;
      color: var(--vm-ink);
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 12px;
      cursor: pointer;
      flex: 0 0 auto;
    }
    #vocab-match .vm-clear:hover { background: rgba(243,234,217,0.08); }
    #vocab-match .vm-clear:focus-visible { outline: none; box-shadow: 0 0 0 3px var(--vm-focus); }

    #vocab-match .vm-inputrow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px solid rgba(243,234,217,0.10);
    }

    #vocab-match input.vm-code {
      width: 56px;
      padding: 6px 8px;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(243,234,217,0.18);
      color: var(--vm-ink);
      border-radius: 10px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      font-size: 13px;
    }
    #vocab-match input.vm-code:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px var(--vm-focus);
      border-color: rgba(120,180,255,0.55);
    }

    #vocab-match .vm-codehint {
      color: var(--vm-faint);
      font-size: 12px;
      line-height: 1.25;
      flex: 1 1 auto;
    }

    #vocab-match .vm-item.vm-correct {
      background: linear-gradient(180deg, var(--vm-good), rgba(0,0,0,0)), var(--vm-card);
      border-color: rgba(78, 210, 146, 0.35);
    }
    #vocab-match .vm-item.vm-wrong {
      background: linear-gradient(180deg, var(--vm-bad), rgba(0,0,0,0)), var(--vm-card);
      border-color: rgba(255, 110, 110, 0.30);
    }

    #vocab-match .vm-footer { padding: 0 6px 2px; }

    #vocab-match .vm-help {
      background: rgba(243,234,217,0.04);
      border: 1px solid rgba(243,234,217,0.10);
      border-radius: var(--vm-radius);
      padding: 10px 12px;
      color: var(--vm-muted);
      font-size: 13px;
    }
    #vocab-match .vm-help summary {
      cursor: pointer;
      font-weight: 800;
      color: var(--vm-ink);
      margin-bottom: 6px;
      outline: none;
    }
    #vocab-match .vm-help ul {
      margin: 8px 0 0;
      padding-left: 18px;
      display: grid;
      gap: 6px;
    }

    @media (max-width: 880px) {
      #vocab-match .vm-board { grid-template-columns: 1fr; }
      #vocab-match .vm-colhint { text-align: left; }
    }
  </style>

  <script>
    (() => {
      const root = document.querySelector("#vocab-match");
      if (!root) return;

      const termsEl = root.querySelector("#vmTerms");
      const defsEl = root.querySelector("#vmDefs");
      const statusEl = root.querySelector(".vm-status");

      const DATA = [
        {
          id: "contr",
          term: "Sonidos contrastivos",
          def: "Sonidos que, si se sustituyen por otros, pueden cambiar el significado de una palabra (funcionan como contraste en el sistema).",
          ex: "Ej.: si “pan” y “van” se distinguen por un sonido, ese contraste cuenta en esa variedad."
        },
        {
          id: "dial",
          term: "Dialecto",
          def: "Variedad de una lengua asociada a una comunidad; no es “incorrecta”, solo diferente.",
          ex: "Ej.: español caribeño, mexicano y peninsular: comparten mucho, pero varían en pronunciación y vocabulario."
        },
        {
          id: "std",
          term: "Variedad estándar",
          def: "Forma de hablar con prestigio social e institucional (escuela, diccionarios, gramáticas) que suele presentarse como la norma.",
          ex: "Ej.: una forma “estándar” puede evitar rasgos estigmatizados aunque sean sistemáticos en un dialecto."
        },
        {
          id: "fonet",
          term: "Fonética",
          def: "Estudio de cómo se producen y se perciben los sonidos del habla (y rasgos como ritmo/entonación).",
          ex: "Ej.: describir si una /s/ final suena como [s], [h] o se pierde en cierto contexto."
        },
        {
          id: "fonol",
          term: "Fonología",
          def: "Estudio de cómo se organizan los sonidos en el sistema de una lengua y cómo crean contrastes de significado.",
          ex: "Ej.: demostrar que dos sonidos son fonemas distintos usando pares mínimos."
        },
        {
          id: "idiom",
          term: "Idioma",
          def: "Lengua de un pueblo o nación (o común a varios), usada por una comunidad amplia.",
          ex: "Ej.: español, inglés y portugués son idiomas con múltiples variedades."
        },
        {
          id: "lengua",
          term: "Lengua",
          def: "Sistema de comunicación verbal propio de una comunidad; una realización concreta del lenguaje humano.",
          ex: "Ej.: el español es una lengua; dentro de ella hay dialectos/variedades."
        },
        {
          id: "lenguaj",
          term: "Lenguaje",
          def: "Capacidad humana general de comunicarse y expresar pensamiento mediante sistemas de signos.",
          ex: "Ej.: una persona tiene lenguaje; aprende una lengua específica (español, inglés, etc.)."
        },
        {
          id: "minpar",
          term: "Par mínimo",
          def: "Dos palabras que se diferencian en un solo sonido y tienen significados distintos; sirve para probar contraste.",
          ex: "Ej.: “pero” vs “perro” (cambia un sonido y cambia el significado)."
        },
        {
          id: "prej",
          term: "Prejuicio lingüístico",
          def: "Juicios o actitudes negativas hacia una manera de hablar que reflejan prejuicios sociales, no inferioridad lingüística.",
          ex: "Ej.: decir que un dialecto “no tiene gramática” por no coincidir con el estándar."
        }
      ];

      const LETTERS = "ABCDEFGHIJ".split("");

      const state = {
        orderTerms: [],
        orderDefs: [],
        mapping: new Map(), // termId -> defId
        selected: null       // { kind: "term"|"def", id: string }
      };

      function shuffle(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
      }

      function setStatus(msg) {
        statusEl.textContent = msg || "";
      }

      function clearFeedback() {
        root.querySelectorAll(".vm-item").forEach(el => {
          el.classList.remove("vm-correct", "vm-wrong");
        });
      }

      function clearSelection() {
        state.selected = null;
        root.querySelectorAll(".vm-item.vm-selected").forEach(el => el.classList.remove("vm-selected"));
      }

      function getLetterForDef(defId) {
        const idx = state.orderDefs.indexOf(defId);
        return idx >= 0 ? LETTERS[idx] : "";
      }

      function getDefByLetter(letter) {
        const idx = LETTERS.indexOf(letter);
        if (idx < 0) return null;
        return state.orderDefs[idx] || null;
      }

      function disconnect(termId) {
        state.mapping.delete(termId);
        const input = root.querySelector(`.vm-item[data-kind="term"][data-term-id="${termId}"] input.vm-code`);
        if (input) input.value = "";
      }

      function connect(termId, defId, announce = true) {
        // enforce one-to-one: remove any term previously mapped to this def
        for (const [tId, dId] of state.mapping.entries()) {
          if (dId === defId) state.mapping.delete(tId);
        }
        state.mapping.set(termId, defId);

        // sync letter input
        const letter = getLetterForDef(defId);
        const input = root.querySelector(`.vm-item[data-kind="term"][data-term-id="${termId}"] input.vm-code`);
        if (input) input.value = letter;

        if (announce) {
          const tObj = DATA.find(x => x.id === termId);
          setStatus(`Conectado: “${tObj ? tObj.term : termId}” → ${letter}.`);
        }
      }

      function render() {
        clearFeedback();
        clearSelection();

        // Terms
        termsEl.innerHTML = "";
        state.orderTerms.forEach((id, idx) => {
          const item = DATA.find(x => x.id === id);

          const li = document.createElement("li");
          li.className = "vm-item";
          li.dataset.kind = "term";
          li.dataset.termId = item.id;
          li.setAttribute("tabindex", "0");
          li.setAttribute("draggable", "true");
          li.setAttribute("role", "button");
          li.setAttribute("aria-label", `Término: ${item.term}. Haz clic para seleccionar.`);

          const top = document.createElement("div");
          top.className = "vm-rowtop";

          const term = document.createElement("div");
          term.className = "vm-term";
          term.textContent = item.term;

          const badge = document.createElement("span");
          badge.className = "vm-tag";
          badge.textContent = String(idx + 1);

          top.appendChild(term);
          top.appendChild(badge);
          li.appendChild(top);

          // Assignment pill + clear
          const defId = state.mapping.get(item.id);
          const assign = document.createElement("div");
          assign.className = "vm-assign";

          const pill = document.createElement("span");
          pill.className = "vm-pill";
          if (defId) {
            const letter = getLetterForDef(defId) || "—";
            pill.innerHTML = `Asignado a: <strong>${letter}</strong>`;
          } else {
            pill.innerHTML = `Asignado a: <strong>—</strong>`;
          }

          const clearBtn = document.createElement("button");
          clearBtn.className = "vm-clear";
          clearBtn.type = "button";
          clearBtn.textContent = "Quitar";
          clearBtn.setAttribute("aria-label", `Quitar conexión de ${item.term}`);
          clearBtn.disabled = !defId;
          clearBtn.addEventListener("click", (ev) => {
            ev.stopPropagation();
            disconnect(item.id);
            render();
            setStatus("Conexión quitada.");
          });

          assign.appendChild(pill);
          assign.appendChild(clearBtn);
          li.appendChild(assign);

          // Letter input (always visible)
          const row = document.createElement("div");
          row.className = "vm-inputrow";

          const hint = document.createElement("div");
          hint.className = "vm-codehint";
          hint.textContent = "Letra (A–J):";

          const input = document.createElement("input");
          input.className = "vm-code";
          input.type = "text";
          input.maxLength = 1;
          input.inputMode = "text";
          input.autocomplete = "off";
          input.spellcheck = false;
          input.setAttribute("aria-label", `Letra para ${item.term} (A a J)`);

          const existing = state.mapping.get(item.id);
          input.value = existing ? (getLetterForDef(existing) || "") : "";

          input.addEventListener("click", (ev) => ev.stopPropagation());
          input.addEventListener("input", () => {
            const v = (input.value || "").toUpperCase().replace(/[^A-J]/g, "");
            input.value = v;

            if (!v) {
              disconnect(item.id);
              render();
              setStatus("Letra borrada: conexión eliminada.");
              return;
            }
            const defFromLetter = getDefByLetter(v);
            if (!defFromLetter) return;
            connect(item.id, defFromLetter, false);
            render();
            setStatus(`Conectado por letra: “${item.term}” → ${v}.`);
          });

          row.appendChild(hint);
          row.appendChild(input);
          li.appendChild(row);

          termsEl.appendChild(li);
        });

        // Definitions
        defsEl.innerHTML = "";
        state.orderDefs.forEach((id, idx) => {
          const item = DATA.find(x => x.id === id);

          const li = document.createElement("li");
          li.className = "vm-item vm-dropzone";
          li.dataset.kind = "def";
          li.dataset.defId = item.id;
          li.setAttribute("tabindex", "0");
          li.setAttribute("role", "button");
          li.setAttribute("aria-label", `Definición ${LETTERS[idx]}. Haz clic para seleccionar.`);

          const top = document.createElement("div");
          top.className = "vm-rowtop";

          const title = document.createElement("div");
          title.className = "vm-term";
          title.textContent = "Definición";

          const letter = document.createElement("span");
          letter.className = "vm-tag";
          letter.textContent = LETTERS[idx];

          top.appendChild(title);
          top.appendChild(letter);

          const def = document.createElement("div");
          def.className = "vm-deftext";
          def.textContent = item.def;

          const ex = document.createElement("div");
          ex.className = "vm-example";
          ex.textContent = item.ex;

          li.appendChild(top);
          li.appendChild(def);
          li.appendChild(ex);

          defsEl.appendChild(li);
        });
      }

      function initOrders() {
        const ids = DATA.map(x => x.id);
        state.orderTerms = shuffle(ids);
        state.orderDefs = shuffle(ids);
      }

      function checkAnswers() {
        clearFeedback();

        let correct = 0;

        // Term cards: correct if mapped to itself (id==id)
        state.orderTerms.forEach((termId) => {
          const termEl = root.querySelector(`.vm-item[data-kind="term"][data-term-id="${termId}"]`);
          const assigned = state.mapping.get(termId);

          if (assigned && assigned === termId) {
            correct++;
            termEl && termEl.classList.add("vm-correct");
          } else {
            termEl && termEl.classList.add("vm-wrong");
          }
        });

        // Def cards: correct if the matching term maps to it
        state.orderDefs.forEach((defId) => {
          const defEl = root.querySelector(`.vm-item[data-kind="def"][data-def-id="${defId}"]`);
          let mappedTerm = null;
          for (const [tId, dId] of state.mapping.entries()) {
            if (dId === defId) { mappedTerm = tId; break; }
          }
          if (mappedTerm && mappedTerm === defId) defEl && defEl.classList.add("vm-correct");
          else defEl && defEl.classList.add("vm-wrong");
        });

        setStatus(`Resultado: ${correct}/${DATA.length} correctas.`);
      }

      function resetGame() {
        state.mapping.clear();
        clearFeedback();
        clearSelection();
        render();
        setStatus("Reiniciado.");
      }

      function shuffleAll() {
        initOrders();
        state.mapping.clear();
        clearFeedback();
        clearSelection();
        render();
        setStatus("Mezclado.");
      }

      function toggleSelect(kind, id) {
        const selector = kind === "term"
          ? `.vm-item[data-kind="term"][data-term-id="${id}"]`
          : `.vm-item[data-kind="def"][data-def-id="${id}"]`;

        const el = root.querySelector(selector);
        if (!el) return;

        // If selecting the same again -> clear
        if (state.selected && state.selected.kind === kind && state.selected.id === id) {
          clearSelection();
          setStatus("Selección cancelada.");
          return;
        }

        clearSelection();
        state.selected = { kind, id };
        el.classList.add("vm-selected");
        setStatus(kind === "term"
          ? "Término seleccionado. Ahora haz clic en una definición."
          : "Definición seleccionada. Ahora haz clic en un término."
        );
      }

      function clickConnect(kind, id) {
        if (!state.selected) {
          toggleSelect(kind, id);
          return;
        }

        // If second click same kind -> switch selection
        if (state.selected.kind === kind) {
          toggleSelect(kind, id);
          return;
        }

        // Connect: term + def
        const termId = (kind === "term") ? id : state.selected.id;
        const defId  = (kind === "def")  ? id : state.selected.id;

        connect(termId, defId, true);
        clearSelection();
        render();
      }

      // Drag handlers
      function attachDragHandlers() {
        // drag start on terms
        termsEl.addEventListener("dragstart", (e) => {
          const li = e.target.closest(".vm-item[data-kind='term']");
          if (!li) return;
          const termId = li.dataset.termId;
          li.classList.add("vm-dragging");
          e.dataTransfer.setData("text/vm-term-id", termId);
          e.dataTransfer.effectAllowed = "move";
        });
        termsEl.addEventListener("dragend", (e) => {
          const li = e.target.closest(".vm-item[data-kind='term']");
          if (!li) return;
          li.classList.remove("vm-dragging");
        });

        // allow drop on defs
        defsEl.addEventListener("dragenter", (e) => {
          const li = e.target.closest(".vm-item[data-kind='def']");
          if (!li) return;
          e.preventDefault();
          li.classList.add("vm-over");
        });
        defsEl.addEventListener("dragover", (e) => {
          const li = e.target.closest(".vm-item[data-kind='def']");
          if (!li) return;
          e.preventDefault();
          li.classList.add("vm-over");
          e.dataTransfer.dropEffect = "move";
        });
        defsEl.addEventListener("dragleave", (e) => {
          const li = e.target.closest(".vm-item[data-kind='def']");
          if (!li) return;
          li.classList.remove("vm-over");
        });
        defsEl.addEventListener("drop", (e) => {
          const li = e.target.closest(".vm-item[data-kind='def']");
          if (!li) return;
          e.preventDefault();
          li.classList.remove("vm-over");

          const termId = e.dataTransfer.getData("text/vm-term-id");
          const defId = li.dataset.defId;
          if (!termId || !defId) return;

          connect(termId, defId, true);
          render();
        });
      }

      // Click handlers (clic→clic)
      function attachClickHandlers() {
        root.addEventListener("click", (e) => {
          const btn = e.target.closest("button.vm-btn");
          if (btn) {
            const action = btn.getAttribute("data-action");
            if (action === "check") checkAnswers();
            if (action === "reset") resetGame();
            if (action === "shuffle") shuffleAll();
            return;
          }

          const termCard = e.target.closest(".vm-item[data-kind='term']");
          if (termCard) {
            clickConnect("term", termCard.dataset.termId);
            return;
          }

          const defCard = e.target.closest(".vm-item[data-kind='def']");
          if (defCard) {
            clickConnect("def", defCard.dataset.defId);
            return;
          }
        });

        // Keyboard support: Enter/Space selects/connects
        root.addEventListener("keydown", (e) => {
          const isActivate = (e.key === "Enter" || e.key === " ");
          if (!isActivate) return;

          const termCard = e.target.closest(".vm-item[data-kind='term']");
          const defCard = e.target.closest(".vm-item[data-kind='def']");
          if (!termCard && !defCard) return;

          e.preventDefault();
          if (termCard) clickConnect("term", termCard.dataset.termId);
          if (defCard) clickConnect("def", defCard.dataset.defId);
        });
      }

      // Init
      initOrders();
      render();
      attachDragHandlers();
      attachClickHandlers();
      setStatus("Conecta arrastrando, clic→clic, o escribiendo letras (A–J).");
    })();
  </script>
</section>


          
        </div>
      </section>

      <section class="card" aria-labelledby="games-title">
        <h3 id="games-title" class="section-title">Games</h3>

        <section class="game-embed" id="game-week4" aria-label="Game embed area (Week 4)">
          <!-- START EDITABLE: GAMES -->
          <!-- Paste a full game block here (HTML + optional <style> + optional <script>) -->

          <!-- NOTE (invisible to students):
               - If your game includes CSS, namespace it inside #game-week4 or .game-embed
                 (example: #game-week4 .my-class { ... } ).
               - If your game includes JS, wrap it in an IIFE:
                 (() => { /* your game code */ })();
               - Avoid touching global styles (body, html) inside your game.
          -->

          <!-- END EDITABLE -->
        </section>
      </section>

      <nav class="page-nav page-nav--bottom" aria-label="Week navigation (bottom)">
        <a class="nav-link" href="../index.html">← Back to weeks</a>

        <div class="nav-group" aria-label="Previous and next week (bottom)">
          <a class="nav-link" href="./week3.html">← Prev</a>
          <a class="nav-link" href="./week5.html">Next →</a>
        </div>
      </nav>
    </main>

    <footer class="footer" role="contentinfo">
      <p>
        Sitio construido por Andrés Correal. Esta página se construyó con la ayuda de los materiales de Grant Armstrong,
        Martiniano Etchart y Kiley Specht.
      </p>
    </footer>

    <script src="../week.js?v=3" defer></script>
  </body>
</html>
